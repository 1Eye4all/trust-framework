--
-- Tables for DTF functionality, HSQL
-- 

CREATE TABLE IF NOT EXISTS Card (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) PRIMARY KEY,
	title VARCHAR(256),
	businessTxt VARCHAR(4096),
	legalTxt VARCHAR(4096),
	technicalTxt VARCHAR(4096)
);

CREATE TABLE IF NOT EXISTS Tag (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) PRIMARY KEY,
	name VARCHAR(256)
);

CREATE TABLE IF NOT EXISTS Dependency (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) PRIMARY KEY,
	cardId BIGINT,
	description VARCHAR(4096)
);

CREATE TABLE IF NOT EXISTS DependencyTags (
	dependencyId BIGINT,
	tagId BIGINT,
	FOREIGN KEY (dependencyId) REFERENCES Dependency(id),
	FOREIGN KEY (tagId) REFERENCES Tag(id)
);

CREATE TABLE IF NOT EXISTS Provides (
	cardId BIGINT,
	tagId BIGINT,
	FOREIGN KEY (cardId) REFERENCES Card(id),
	FOREIGN KEY (tagId) REFERENCES Tag(id)
);

CREATE TABLE IF NOT EXISTS Instance (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) PRIMARY KEY,
	name VARCHAR(256),
	rootCardNodeId BIGINT
);

CREATE TABLE IF NOT EXISTS CardNode (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) PRIMARY KEY,
	cardId BIGINT,
	parentCardNodeId BIGINT,
	FOREIGN KEY (cardId) REFERENCES Card(id),
	FOREIGN KEY (parentCardNodeId) REFERENCES CardNode(id)
);

CREATE TABLE IF NOT EXISTS InstanceCardNodes (
	instanceId BIGINT,
	cardNodeId BIGINT,
	FOREIGN KEY (instanceId) REFERENCES Instance(id),
	FOREIGN KEY (cardNodeId) REFERENCES CardNode(id)
);